<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.45">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/icon/111.ico"><title>elastic search简介 | shAilene</title><meta name="description" content="just be simple.">
    <link rel="modulepreload" href="/study/assets/app.4e5a7100.js"><link rel="modulepreload" href="/study/assets/ES.html.e50fa5be.js"><link rel="modulepreload" href="/study/assets/ES.html.79218e9b.js"><link rel="prefetch" href="/study/assets/index.html.cc085cf1.js"><link rel="prefetch" href="/study/assets/index.html.763c73a0.js"><link rel="prefetch" href="/study/assets/index.html.074760ca.js"><link rel="prefetch" href="/study/assets/index.html.ff759a47.js"><link rel="prefetch" href="/study/assets/index.html.dde20e30.js"><link rel="prefetch" href="/study/assets/index.html.f18f6eeb.js"><link rel="prefetch" href="/study/assets/index.html.3b4ee2ac.js"><link rel="prefetch" href="/study/assets/设计模式1.html.d254a4fb.js"><link rel="prefetch" href="/study/assets/设计模式2.html.c1bb479a.js"><link rel="prefetch" href="/study/assets/gin.html.d64dfd47.js"><link rel="prefetch" href="/study/assets/golang.html.16099e4e.js"><link rel="prefetch" href="/study/assets/gorm.html.18769af2.js"><link rel="prefetch" href="/study/assets/Javaweb.html.6822767e.js"><link rel="prefetch" href="/study/assets/docker.html.5ab0d932.js"><link rel="prefetch" href="/study/assets/kafka.html.9d038d97.js"><link rel="prefetch" href="/study/assets/vue基础.html.e141ee41.js"><link rel="prefetch" href="/study/assets/vue组件.html.4748d6a7.js"><link rel="prefetch" href="/study/assets/一些知识点的记录.html.798adcda.js"><link rel="prefetch" href="/study/assets/Java笔记.html.3daff183.js"><link rel="prefetch" href="/study/assets/dubbo.html.54518c15.js"><link rel="prefetch" href="/study/assets/springcloud（上）.html.f9694838.js"><link rel="prefetch" href="/study/assets/springcloud（下）.html.8ddee628.js"><link rel="prefetch" href="/study/assets/zookeeper.html.5728d718.js"><link rel="prefetch" href="/study/assets/《并发编程的艺术》笔记.html.096bbe6f.js"><link rel="prefetch" href="/study/assets/并发编程.html.4e11253b.js"><link rel="prefetch" href="/study/assets/尚硅谷_宋红康_JDBC.html.4b7a32bc.js"><link rel="prefetch" href="/study/assets/redis.html.098d7b82.js"><link rel="prefetch" href="/study/assets/Mybatis.html.bef8c38c.js"><link rel="prefetch" href="/study/assets/spring.html.728ddcf2.js"><link rel="prefetch" href="/study/assets/springboot.html.515b4e7b.js"><link rel="prefetch" href="/study/assets/springboot.html.74edc301.js"><link rel="prefetch" href="/study/assets/springMVC.html.43a301bd.js"><link rel="prefetch" href="/study/assets/RabbitMQ.html.9428006f.js"><link rel="prefetch" href="/study/assets/操作系统.html.ddd809ec.js"><link rel="prefetch" href="/study/assets/flink基本篇1.html.585b5f0e.js"><link rel="prefetch" href="/study/assets/flink基本篇2.html.6e89c1e9.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第一部分.html.5c5c9afa.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第二部分.html.62932cc9.js"><link rel="prefetch" href="/study/assets/404.html.93146c89.js"><link rel="prefetch" href="/study/assets/index.html.9941bc88.js"><link rel="prefetch" href="/study/assets/index.html.ba4d5cb6.js"><link rel="prefetch" href="/study/assets/index.html.92c2648f.js"><link rel="prefetch" href="/study/assets/index.html.275631af.js"><link rel="prefetch" href="/study/assets/index.html.dce06860.js"><link rel="prefetch" href="/study/assets/index.html.12c7d9e3.js"><link rel="prefetch" href="/study/assets/index.html.64017171.js"><link rel="prefetch" href="/study/assets/设计模式1.html.f9509174.js"><link rel="prefetch" href="/study/assets/设计模式2.html.1448346a.js"><link rel="prefetch" href="/study/assets/gin.html.e84e137e.js"><link rel="prefetch" href="/study/assets/golang.html.9f2a4ad8.js"><link rel="prefetch" href="/study/assets/gorm.html.29c23928.js"><link rel="prefetch" href="/study/assets/Javaweb.html.b8b69904.js"><link rel="prefetch" href="/study/assets/docker.html.f9b87572.js"><link rel="prefetch" href="/study/assets/kafka.html.bf129f92.js"><link rel="prefetch" href="/study/assets/vue基础.html.632361f6.js"><link rel="prefetch" href="/study/assets/vue组件.html.99d0cd49.js"><link rel="prefetch" href="/study/assets/一些知识点的记录.html.4d54b2ed.js"><link rel="prefetch" href="/study/assets/Java笔记.html.94eb4cc9.js"><link rel="prefetch" href="/study/assets/dubbo.html.faf3ca04.js"><link rel="prefetch" href="/study/assets/springcloud（上）.html.c74a33f2.js"><link rel="prefetch" href="/study/assets/springcloud（下）.html.2efcab09.js"><link rel="prefetch" href="/study/assets/zookeeper.html.b129f230.js"><link rel="prefetch" href="/study/assets/《并发编程的艺术》笔记.html.3629803c.js"><link rel="prefetch" href="/study/assets/并发编程.html.4dbc83ff.js"><link rel="prefetch" href="/study/assets/尚硅谷_宋红康_JDBC.html.7a23c582.js"><link rel="prefetch" href="/study/assets/redis.html.fa43852e.js"><link rel="prefetch" href="/study/assets/Mybatis.html.319d9304.js"><link rel="prefetch" href="/study/assets/spring.html.08488cf6.js"><link rel="prefetch" href="/study/assets/springboot.html.7dea3ce4.js"><link rel="prefetch" href="/study/assets/springboot.html.ac553e9e.js"><link rel="prefetch" href="/study/assets/springMVC.html.bcee5852.js"><link rel="prefetch" href="/study/assets/RabbitMQ.html.68fd4ad6.js"><link rel="prefetch" href="/study/assets/操作系统.html.7226aca8.js"><link rel="prefetch" href="/study/assets/flink基本篇1.html.26f7d4ae.js"><link rel="prefetch" href="/study/assets/flink基本篇2.html.c7d8048a.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第一部分.html.3e94b54b.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第二部分.html.27393be1.js"><link rel="prefetch" href="/study/assets/404.html.085ef4ab.js"><link rel="prefetch" href="/study/assets/404.65bb6fca.js"><link rel="prefetch" href="/study/assets/Layout.a12f3a75.js">
    <link rel="stylesheet" href="/study/assets/style.2bba04cf.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/study/" class=""><img class="logo" src="/study/images/leo.jpg" alt="shAilene"><span class="site-name can-hide">shAilene</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/study/计算机基础/" class="" aria-label="计算机基础"><!--[--><!--]--> 计算机基础 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/java/" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/go/" class="" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/mw/" class="router-link-active" aria-label="中间件"><!--[--><!--]--> 中间件 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/Design-patterns/" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/前端/" class="" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/study/计算机基础/" class="" aria-label="计算机基础"><!--[--><!--]--> 计算机基础 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/java/" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/go/" class="" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/mw/" class="router-link-active" aria-label="中间件"><!--[--><!--]--> 中间件 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/Design-patterns/" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/前端/" class="" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">elastic search简介 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#一、概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="一、概述"><!--[--><!--]--> 一、概述 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#es" class="router-link-active router-link-exact-active sidebar-item" aria-label="es"><!--[--><!--]--> es <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#全文搜索" class="router-link-active router-link-exact-active sidebar-item" aria-label="全文搜索"><!--[--><!--]--> 全文搜索 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#二、入门" class="router-link-active router-link-exact-active sidebar-item" aria-label="二、入门"><!--[--><!--]--> 二、入门 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#restful" class="router-link-active router-link-exact-active sidebar-item" aria-label="RESTful"><!--[--><!--]--> RESTful <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#数据格式" class="router-link-active router-link-exact-active sidebar-item" aria-label="数据格式"><!--[--><!--]--> 数据格式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#三、基本使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="三、基本使用"><!--[--><!--]--> 三、基本使用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#索引操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="索引操作"><!--[--><!--]--> 索引操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#创建索引" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建索引"><!--[--><!--]--> 创建索引 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#获取索引信息" class="router-link-active router-link-exact-active sidebar-item" aria-label="获取索引信息"><!--[--><!--]--> 获取索引信息 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#删除索引" class="router-link-active router-link-exact-active sidebar-item" aria-label="删除索引"><!--[--><!--]--> 删除索引 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#文档操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="文档操作"><!--[--><!--]--> 文档操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#创建文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建文档"><!--[--><!--]--> 创建文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询文档"><!--[--><!--]--> 查询文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#修改文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="修改文档"><!--[--><!--]--> 修改文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#删除文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="删除文档"><!--[--><!--]--> 删除文档 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询操作"><!--[--><!--]--> 查询操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#条件查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="条件查询"><!--[--><!--]--> 条件查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#全查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="全查询"><!--[--><!--]--> 全查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#分页查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="分页查询"><!--[--><!--]--> 分页查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#返回指定字段" class="router-link-active router-link-exact-active sidebar-item" aria-label="返回指定字段"><!--[--><!--]--> 返回指定字段 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#指定字段排序" class="router-link-active router-link-exact-active sidebar-item" aria-label="指定字段排序"><!--[--><!--]--> 指定字段排序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#多条件查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="多条件查询"><!--[--><!--]--> 多条件查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#范围查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="范围查询"><!--[--><!--]--> 范围查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#全文检索" class="router-link-active router-link-exact-active sidebar-item" aria-label="全文检索"><!--[--><!--]--> 全文检索 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#高亮" class="router-link-active router-link-exact-active sidebar-item" aria-label="高亮"><!--[--><!--]--> 高亮 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#聚合操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="聚合操作"><!--[--><!--]--> 聚合操作 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#映射" class="router-link-active router-link-exact-active sidebar-item" aria-label="映射"><!--[--><!--]--> 映射 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="概述"><!--[--><!--]--> 概述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#创建mapping" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建mapping"><!--[--><!--]--> 创建mapping <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询mapping信息" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询mapping信息"><!--[--><!--]--> 查询mapping信息 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#四、javaapi" class="router-link-active router-link-exact-active sidebar-item" aria-label="四、JavaAPI"><!--[--><!--]--> 四、JavaAPI <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#环境准备" class="router-link-active router-link-exact-active sidebar-item" aria-label="环境准备"><!--[--><!--]--> 环境准备 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#客户端配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="客户端配置"><!--[--><!--]--> 客户端配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#索引操作-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="索引操作"><!--[--><!--]--> 索引操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#创建索引-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建索引"><!--[--><!--]--> 创建索引 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询索引" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询索引"><!--[--><!--]--> 查询索引 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#删除索引-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="删除索引"><!--[--><!--]--> 删除索引 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#文档操作-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="文档操作"><!--[--><!--]--> 文档操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#添加文档" class="router-link-active router-link-exact-active sidebar-item" aria-label="添加文档"><!--[--><!--]--> 添加文档 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#修改数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="修改数据"><!--[--><!--]--> 修改数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询数据"><!--[--><!--]--> 查询数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#删除数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="删除数据"><!--[--><!--]--> 删除数据 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#批量文档操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="批量文档操作"><!--[--><!--]--> 批量文档操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#批量插入" class="router-link-active router-link-exact-active sidebar-item" aria-label="批量插入"><!--[--><!--]--> 批量插入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#批量删除" class="router-link-active router-link-exact-active sidebar-item" aria-label="批量删除"><!--[--><!--]--> 批量删除 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#条件查询-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="条件查询"><!--[--><!--]--> 条件查询 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询所有数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询所有数据"><!--[--><!--]--> 查询所有数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#指定字段查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="指定字段查询"><!--[--><!--]--> 指定字段查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#分页查询-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="分页查询"><!--[--><!--]--> 分页查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询结果排序" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询结果排序"><!--[--><!--]--> 查询结果排序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#返回指定字段-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="返回指定字段"><!--[--><!--]--> 返回指定字段 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#高级查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="高级查询"><!--[--><!--]--> 高级查询 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#组合查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="组合查询"><!--[--><!--]--> 组合查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#范围查询-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="范围查询"><!--[--><!--]--> 范围查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#模糊查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="模糊查询"><!--[--><!--]--> 模糊查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#高亮查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="高亮查询"><!--[--><!--]--> 高亮查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#聚合查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="聚合查询"><!--[--><!--]--> 聚合查询 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#分组查询" class="router-link-active router-link-exact-active sidebar-item" aria-label="分组查询"><!--[--><!--]--> 分组查询 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#五、es环境" class="router-link-active router-link-exact-active sidebar-item" aria-label="五、ES环境"><!--[--><!--]--> 五、ES环境 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#概述-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="概述"><!--[--><!--]--> 概述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#节点" class="router-link-active router-link-exact-active sidebar-item" aria-label="节点"><!--[--><!--]--> 节点 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#win集群部署" class="router-link-active router-link-exact-active sidebar-item" aria-label="WIN集群部署"><!--[--><!--]--> WIN集群部署 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#修改配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="修改配置"><!--[--><!--]--> 修改配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#查询节点状态" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询节点状态"><!--[--><!--]--> 查询节点状态 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#linux单点部署" class="router-link-active router-link-exact-active sidebar-item" aria-label="Linux单点部署"><!--[--><!--]--> Linux单点部署 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#修改配置-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="修改配置"><!--[--><!--]--> 修改配置 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#linux集群部署" class="router-link-active router-link-exact-active sidebar-item" aria-label="Linux集群部署"><!--[--><!--]--> Linux集群部署 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#修改配置-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="修改配置"><!--[--><!--]--> 修改配置 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#六、es进阶" class="router-link-active router-link-exact-active sidebar-item" aria-label="六、ES进阶"><!--[--><!--]--> 六、ES进阶 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/mw/elasticsearch/ES.html#核心概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="核心概念"><!--[--><!--]--> 核心概念 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="elastic-search" tabindex="-1"><a class="header-anchor" href="#elastic-search" aria-hidden="true">#</a> Elastic Search</h1><h2 id="一、概述" tabindex="-1"><a class="header-anchor" href="#一、概述" aria-hidden="true">#</a> 一、概述</h2><h3 id="es" tabindex="-1"><a class="header-anchor" href="#es" aria-hidden="true">#</a> es</h3><ol><li><p>elastic search是用于存储、搜索的项目</p><p>kibana是展示数据的项目</p><p>kibana结合es可以<strong>实时地对数据进行搜索、分析和可视化。</strong></p></li><li><p>es是一个开源的高扩展的分布式全文搜索引擎，是整个elastic stack技术栈的核心。</p><p>它可以近乎实时地存储、检索数据。</p></li><li><p>es的全文搜索的原理是倒排索引。</p></li><li><p>Lucene是Apache软件基金会Jakarta项目组的一个子项目，提供了一个简单却强大的应用程式接口，能够做全文索引和搜寻。</p><p>但Lucene只是一个<strong>提供全文搜索功能类库</strong>的核心工具包，而真正使用它还需要一个<strong>完善的服务框架</strong>搭建起来进行应用。</p><p>这里的完善的服务框架便是说的es和solr。</p></li><li><p>es是基于Java开发的。</p></li></ol><h3 id="全文搜索" tabindex="-1"><a class="header-anchor" href="#全文搜索" aria-hidden="true">#</a> 全文搜索</h3><ol><li><p>Google，百度类的网站搜索，它们都是根据网页中的关键字生成索引，我们在搜索的时候输入关键字，它们会将该关键字即索引匹配到的所有网页返回；还有常见的项目中应用日志的搜索等等。对于这些非结构化的数据文本，关系型数据库搜索不是能很好的支持。</p></li><li><p>一般的传统关系型数据库，都不会用来进行全文检索，一般也没有人用关系型数据库存储文本字段。进行全文检索需要扫描整个表，如果数据量大的话即使对SQL语法进行优化，也收效甚微。</p></li><li><p>使用ES或Solr这种全文检索引擎：</p><ul><li>搜索的数据对象是大量的非结构化的文本数据。</li><li>文件记录量达到数十万或数百万甚至更多</li><li>对高度相关的搜索结果的有特殊需求，但是没有可用的关系数据库可以满足。</li></ul></li><li><p>全文检索的工作原理</p><ul><li><p>分词</p></li><li><p>对词进行处理，缩减为词根等等</p></li><li><p>根据TF-IDF算法对每一个词计算频率，分别是这个词在当前文档中出现的次数，以及这个词在整个数据集中在哪些文档中出现了</p></li><li><p>根据上一步计算出的两个指标，对词进行排序，这个就是构建倒排索引</p><p>TF-IDF算法是根据词在单个文档中出现的次数和在全部文档中出现的次数。</p></li><li><p>检索程序就根据事先建立的索引进行查找</p></li></ul></li></ol><h2 id="二、入门" tabindex="-1"><a class="header-anchor" href="#二、入门" aria-hidden="true">#</a> 二、入门</h2><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h3><ol><li><p>windows版的es压缩包，解压即安装完成。</p></li><li><p>目录：</p><table><thead><tr><th>目录</th><th>含义</th></tr></thead><tbody><tr><td>bin</td><td>可执行文件目录</td></tr><tr><td>config</td><td>配置目录</td></tr><tr><td>jdk</td><td>内置jdk</td></tr><tr><td>lib</td><td>类库</td></tr><tr><td>logs</td><td>日志目录</td></tr><tr><td>modules</td><td>模块目录</td></tr><tr><td>plugins</td><td>插件目录</td></tr></tbody></table></li><li><p>bin目录下的elasticsearch.bat即是windows版本的es服务启动文件。</p></li><li><p>9300端口为elasticsearch集群间组件的通信端口，9200端口为浏览器访问的http协议的restful端口。</p></li><li><p>路径是对资源的定位，方法是对资源的操作。</p></li></ol><h3 id="restful" tabindex="-1"><a class="header-anchor" href="#restful" aria-hidden="true">#</a> RESTful</h3><ol><li><p>ES的对数据的操作是符合RESTful风格的API</p><p>ES的<strong>请求和响应都是JSON字符串。</strong></p></li><li><p>对RESTful的简单理解：</p><p>如果想要访问互联网上的资源，就必须向资源所在的服务器发出请求，请求体中必须包含资源的网络路径，以及对资源的操作。</p><p>REST样式的API的响应大多是JSON格式的字符串。网络中是传不了对象的，必须要进行序列化。</p></li><li><p>HTTP 1.1标准中没有规定GET方法是否可以有请求体，因此GET方法也可以带有请求体，完全符合标准。ES中就是用GET方法的请求体传递搜索条件，为了兼容性考虑，ES也接收POST方法+请求体的搜索方式。</p></li></ol><h3 id="数据格式" tabindex="-1"><a class="header-anchor" href="#数据格式" aria-hidden="true">#</a> 数据格式</h3><ol><li><p>ElasticSearch是面向文档型数据库，一条数据在这里就是一个文档。</p></li><li><p>与MySQL对比的话，如下</p><div class="language-text ext-text"><pre class="language-text"><code>index    type  document fields
database table row      column
</code></pre></div><p>这里type的概念被弱化，ES6.X中，一个index下已经只能包含一个Type，而不是像MySQL一样，一个数据里有多张数据表。而到ES7.X中，Type的概念已经被删除了。</p></li><li><p>全文搜索引擎，不管是ES还是solr都会进行分词；对词进行语法优化；根据TF-IDF算法，为词建立倒排索引</p><p>这里并没有表的概念。</p></li></ol><h2 id="三、基本使用" tabindex="-1"><a class="header-anchor" href="#三、基本使用" aria-hidden="true">#</a> 三、基本使用</h2><h3 id="索引操作" tabindex="-1"><a class="header-anchor" href="#索引操作" aria-hidden="true">#</a> 索引操作</h3><h4 id="创建索引" tabindex="-1"><a class="header-anchor" href="#创建索引" aria-hidden="true">#</a> 创建索引</h4><ol><li><p>对比关系型数据库，创建索引就等同于创建数据库。</p><p>在postman中，向ES服务发送<code>PUT</code>请求：http://localhost:9200/shopping</p></li><li><p><code>PUT localhost:9200/shopping</code></p><p>response:</p><div class="language-text ext-text"><pre class="language-text"><code>{
    &quot;acknowledged&quot;: true,
    &quot;shards_acknowledged&quot;: true,
    &quot;index&quot;: &quot;shopping&quot;
}
</code></pre></div><p>&quot;acknowledged&quot;: true 表示创建index成功</p><p>PUT具有幂等性，意味着只要发送同样的请求，结果一样，所以这个时候如果再发送一次请求，就会提示index已存在。</p><p>POST没有幂等性，两次操作可能结果不一样，所以如果用POST创建索引，那么可能创建两个名称一样的索引（两次创建索引都会成功），这是不允许的。</p><p><strong>不能用POST方式来创建索引。</strong></p></li></ol><h4 id="获取索引信息" tabindex="-1"><a class="header-anchor" href="#获取索引信息" aria-hidden="true">#</a> 获取索引信息</h4><ol><li><p><code>GET localhost:9200/shopping</code></p><p>获取索引shopping的相关信息。</p></li><li><p>查看所有索引</p><p><code>GET localhost:9200/_cat/indices?v</code></p></li></ol><h4 id="删除索引" tabindex="-1"><a class="header-anchor" href="#删除索引" aria-hidden="true">#</a> 删除索引</h4><ol><li><code>DELETE localhost:9200/shopping</code></li></ol><h3 id="文档操作" tabindex="-1"><a class="header-anchor" href="#文档操作" aria-hidden="true">#</a> 文档操作</h3><h4 id="创建文档" tabindex="-1"><a class="header-anchor" href="#创建文档" aria-hidden="true">#</a> 创建文档</h4><ol><li><p>添加的数据格式为JSON格式。</p><p>指定索引，向ES服务器发送POST请求。这里不能使用PUT请求。</p><p>创建</p><p><code>http://localhost:9200/shopping/_doc</code></p><p>requestBody:</p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米手机&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;images&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">3999.00</span>
<span class="token punctuation">}</span>
</code></pre></div><p>response</p><div class="language-text ext-text"><pre class="language-text"><code>{
    &quot;_index&quot;: &quot;shopping&quot;,
    &quot;_type&quot;: &quot;_doc&quot;,
    &quot;_id&quot;: &quot;Xs9ZEoMBp69JQLv9Eto8&quot;,
    &quot;_version&quot;: 1,
    &quot;result&quot;: &quot;created&quot;,
    &quot;_shards&quot;: {
        &quot;total&quot;: 2,
        &quot;successful&quot;: 1,
        &quot;failed&quot;: 0
    },
    &quot;_seq_no&quot;: 1,
    &quot;_primary_term&quot;: 1
}
</code></pre></div><p>可以看到response中有一个字段是_id，这是由es随机生成的，也就意味着，每次发送请求，返回的结果都不一样，而PUT请求是幂等性的，多次发出请求，返回的结果一样，所以这里不能使用具有幂等性的PUT请求。</p><p>这个_id是数据的唯一性标识，类似于数据表中的主键。</p></li><li><p>创建文档--指定ID</p><p><code>POST/PUT localhost:9200/shopping/_doc/1001</code></p><p>这是一个幂等性的操作，所以用PUT请求也可以。</p><p><code>POST/PUT localhost:9200/shopping/_create/1002</code></p></li></ol><h4 id="查询文档" tabindex="-1"><a class="header-anchor" href="#查询文档" aria-hidden="true">#</a> 查询文档</h4><ol><li><p>根据ID进行单条数据查询</p><p><code>GET localhost:9200/shopping/_doc/1002</code></p><p>response</p><div class="language-text ext-text"><pre class="language-text"><code>{
    &quot;_index&quot;: &quot;shopping&quot;,
    &quot;_type&quot;: &quot;_doc&quot;,
    &quot;_id&quot;: &quot;1002&quot;,
    &quot;_version&quot;: 1,
    &quot;_seq_no&quot;: 3,
    &quot;_primary_term&quot;: 1,
    &quot;found&quot;: true,
    &quot;_source&quot;: {
        &quot;title&quot;: &quot;小米手机&quot;,
        &quot;category&quot;: &quot;小米&quot;,
        &quot;images&quot;: &quot;http://www.gulixueyuan.com/xm.jpg&quot;,
        &quot;price&quot;: 3999.00
    }
}
</code></pre></div><p>_source表示查询结果，也就是数据源，这种方式类似于主键查询。</p></li><li><p>查询指定索引下的所有数据</p><p><code>GET localhost:9200/shopping/_search</code></p><p>response</p><div class="language-text ext-text"><pre class="language-text"><code>{
    &quot;took&quot;: 8,
    &quot;timed_out&quot;: false,
    &quot;_shards&quot;: {
        &quot;total&quot;: 1,
        &quot;successful&quot;: 1,
        &quot;skipped&quot;: 0,
        &quot;failed&quot;: 0
    },
    &quot;hits&quot;: {
        &quot;total&quot;: {
            &quot;value&quot;: 4,
            &quot;relation&quot;: &quot;eq&quot;
        },
        &quot;max_score&quot;: 1.0,
        &quot;hits&quot;: [
            {
                &quot;_index&quot;: &quot;shopping&quot;,
                &quot;_type&quot;: &quot;_doc&quot;,
                &quot;_id&quot;: &quot;Xc9XEoMBp69JQLv9LNpW&quot;,
                &quot;_score&quot;: 1.0,
                &quot;_source&quot;: {
                    &quot;title&quot;: &quot;小米手机&quot;,
                    &quot;category&quot;: &quot;小米&quot;,
                    &quot;images&quot;: &quot;http://www.gulixueyuan.com/xm.jpg&quot;,
                    &quot;price&quot;: 3999.00
                }
            },
            {
                &quot;_index&quot;: &quot;shopping&quot;,
                &quot;_type&quot;: &quot;_doc&quot;,
                &quot;_id&quot;: &quot;Xs9ZEoMBp69JQLv9Eto8&quot;,
                &quot;_score&quot;: 1.0,
                &quot;_source&quot;: {
                    &quot;title&quot;: &quot;小米手机&quot;,
                    &quot;category&quot;: &quot;小米&quot;,
                    &quot;images&quot;: &quot;http://www.gulixueyuan.com/xm.jpg&quot;,
                    &quot;price&quot;: 3999.00
                }
            },
            {
                &quot;_index&quot;: &quot;shopping&quot;,
                &quot;_type&quot;: &quot;_doc&quot;,
                &quot;_id&quot;: &quot;1001&quot;,
                &quot;_score&quot;: 1.0,
                &quot;_source&quot;: {
                    &quot;title&quot;: &quot;小米手机&quot;,
                    &quot;category&quot;: &quot;小米&quot;,
                    &quot;images&quot;: &quot;http://www.gulixueyuan.com/xm.jpg&quot;,
                    &quot;price&quot;: 3999.00
                }
            },
            {
                &quot;_index&quot;: &quot;shopping&quot;,
                &quot;_type&quot;: &quot;_doc&quot;,
                &quot;_id&quot;: &quot;1002&quot;,
                &quot;_score&quot;: 1.0,
                &quot;_source&quot;: {
                    &quot;title&quot;: &quot;小米手机&quot;,
                    &quot;category&quot;: &quot;小米&quot;,
                    &quot;images&quot;: &quot;http://www.gulixueyuan.com/xm.jpg&quot;,
                    &quot;price&quot;: 3999.00
                }
            }
        ]
    }
}
</code></pre></div></li></ol><h4 id="修改文档" tabindex="-1"><a class="header-anchor" href="#修改文档" aria-hidden="true">#</a> 修改文档</h4><ol><li><p>根据id修改文档</p><p><code>PUT/POST localhost:9200/shopping/_doc/1001</code></p><p>requestBody</p><div class="language-text ext-text"><pre class="language-text"><code>{
	&quot;title&quot;: &quot;小米手机&quot;,
    &quot;category&quot;: &quot;小米&quot;,
    &quot;images&quot;: &quot;http://www.gulixueyuan.com/xm.jpg&quot;,
    &quot;price&quot;: 4000.00
}
</code></pre></div><p>response</p><div class="language-text ext-text"><pre class="language-text"><code>{
    &quot;_index&quot;: &quot;shopping&quot;,
    &quot;_type&quot;: &quot;_doc&quot;,
    &quot;_id&quot;: &quot;1001&quot;,
    &quot;_version&quot;: 2,
    &quot;result&quot;: &quot;updated&quot;,
    &quot;_shards&quot;: {
        &quot;total&quot;: 2,
        &quot;successful&quot;: 1,
        &quot;failed&quot;: 0
    },
    &quot;_seq_no&quot;: 5,
    &quot;_primary_term&quot;: 1
}
</code></pre></div></li><li><p>局部修改</p><p><code>POST localhost:9200/shopping/_update/1001</code></p><p>requestBody</p><div class="language-text ext-text"><pre class="language-text"><code>{
	&quot;doc&quot;: {
        &quot;title&quot;: &quot;华为手机&quot;
    }
}
</code></pre></div></li></ol><h4 id="删除文档" tabindex="-1"><a class="header-anchor" href="#删除文档" aria-hidden="true">#</a> 删除文档</h4><ol><li><p>根据ID删除单个文档</p><p><code>DELETE localhost:9200/shopping/_doc/1001</code></p></li></ol><h3 id="查询操作" tabindex="-1"><a class="header-anchor" href="#查询操作" aria-hidden="true">#</a> 查询操作</h3><h4 id="条件查询" tabindex="-1"><a class="header-anchor" href="#条件查询" aria-hidden="true">#</a> 条件查询</h4><ol><li><p><code>GET localhost:9200/shopping/_search?q=category:小米</code></p></li><li><p>对以上的条件查询，会调整为根据请求体requestBody来传递参数</p><p><code>GET localhost:9200/shopping/_search</code></p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>没有在地址栏上写查询的参数</p></li></ol><h4 id="全查询" tabindex="-1"><a class="header-anchor" href="#全查询" aria-hidden="true">#</a> 全查询</h4><p><code>GET localhost:9200/shopping/_search</code></p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>等价于<code>GET localhost:9200/shopping/_search</code></p><p><strong>可以不带请求体！HTTP 1.1标准中没有规定GET方法是否可以有请求体，因此GET方法也可以带请求体，完全符合标准。elasticsearch中就是用GET方法的请求体传递搜索条件。为了兼容性考虑，elasticsearch也接受POST方法+请求体的搜索方式。</strong></p><p>不带请求体只适用于全查询，因为不需要给查询条件。</p><h4 id="分页查询" tabindex="-1"><a class="header-anchor" href="#分页查询" aria-hidden="true">#</a> 分页查询</h4><p><code>GET localhost:9200/shopping/_search</code></p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div><p>from表示<strong>当前页数据的起始位置</strong></p><p>size表示<strong>当前页有多少条数据</strong></p><h4 id="返回指定字段" tabindex="-1"><a class="header-anchor" href="#返回指定字段" aria-hidden="true">#</a> 返回指定字段</h4><p><code>GET localhost:9200/shopping/_search</code></p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="指定字段排序" tabindex="-1"><a class="header-anchor" href="#指定字段排序" aria-hidden="true">#</a> 指定字段排序</h4><p><code>GET localhost:9200/shopping/_search</code></p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="多条件查询" tabindex="-1"><a class="header-anchor" href="#多条件查询" aria-hidden="true">#</a> 多条件查询</h4><ol><li><p>多个条件同时成立--AND</p><p>must用数组，表示多条件的意思</p><p><code>localhost:9200/shopping/_search</code></p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>must就是and的意思，就是must后面的数组里面的条件要同时成立</p></li><li><p>OR</p><p>must改为了should</p><div class="language-json ext-json"><pre class="language-json"><code>    <span class="token punctuation">{</span>
        <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                     <span class="token punctuation">{</span>
                        <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;华为&quot;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="范围查询" tabindex="-1"><a class="header-anchor" href="#范围查询" aria-hidden="true">#</a> 范围查询</h4><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
					<span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
						<span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
						<span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;华为&quot;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
						<span class="token property">&quot;gt&quot;</span><span class="token operator">:</span> <span class="token number">3000</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="全文检索" tabindex="-1"><a class="header-anchor" href="#全文检索" aria-hidden="true">#</a> 全文检索</h4><ol><li><p>完全匹配</p><div class="language-json ext-json"><pre class="language-json"><code>    <span class="token punctuation">{</span>
        <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;match_phrase&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;华为&quot;</span>
            <span class="token punctuation">}</span>
                
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="高亮" tabindex="-1"><a class="header-anchor" href="#高亮" aria-hidden="true">#</a> 高亮</h4><ol><li><div class="language-json ext-json"><pre class="language-json"><code>    <span class="token punctuation">{</span>
        <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;match_phrase&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="聚合操作" tabindex="-1"><a class="header-anchor" href="#聚合操作" aria-hidden="true">#</a> 聚合操作</h4><ol><li><p>按分组统计</p><p>request</p><div class="language-json ext-json"><pre class="language-json"><code>    <span class="token punctuation">{</span>
        <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;price_group&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//分组</span>
                    <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;price&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>response</p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;took&quot;</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timed_out&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_shards&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;successful&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;skipped&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;failed&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token property">&quot;relation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eq&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max_score&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shopping&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Xc9XEoMBp69JQLv9LNpW&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_score&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米手机&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;images&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">3999.00</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shopping&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Xs9ZEoMBp69JQLv9Eto8&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_score&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米手机&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;images&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">3999.00</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shopping&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1002&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_score&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米手机&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;images&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">3999.00</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shopping&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1004&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_score&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米手机&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;category&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小米&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;images&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">3999.00</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;aggregations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;price_group&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;doc_count_error_upper_bound&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sum_other_doc_count&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;buckets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token number">3999.0</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;doc_count&quot;</span><span class="token operator">:</span> <span class="token number">4</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>计算某个字段的平均值</p><p>request</p><p>size 为0表示不要原始数据。</p><div class="language-json ext-json"><pre class="language-json"><code>    <span class="token punctuation">{</span>
        <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;price_avg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;avg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;price&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;size&quot;</span><span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>response</p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;took&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timed_out&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_shards&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;successful&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;skipped&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;failed&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            <span class="token property">&quot;relation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eq&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;max_score&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;aggregations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;price_avg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">3999.0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="映射" tabindex="-1"><a class="header-anchor" href="#映射" aria-hidden="true">#</a> 映射</h3><h4 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h4><ol><li><strong>在MySQL中，字段类型、长度等信息都属于表的结构信息，在ES中，也有类似的概念，称之为映射mapping。</strong></li></ol><h4 id="创建mapping" tabindex="-1"><a class="header-anchor" href="#创建mapping" aria-hidden="true">#</a> 创建mapping</h4><ol><li><p><code>PUT localhost:9200/user/_mapping</code></p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> <span class="token comment">//text意思是name的类型是文本，意味着可以分词</span>
			<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//表示这个字段可以索引查询</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;sex&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span> <span class="token comment">//keyword表示不能分词，必须完整匹配</span>
			<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//表示这个字段可以索引查询</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;tel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span> <span class="token comment">//keyword表示不能分词，必须完整匹配</span>
			<span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//表示这个字段不可以索引查询</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="查询mapping信息" tabindex="-1"><a class="header-anchor" href="#查询mapping信息" aria-hidden="true">#</a> 查询mapping信息</h4><ol><li><p><code>GET localhost:9200/user/_mapping</code></p><p>response</p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">&quot;tel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;index&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h2 id="四、javaapi" tabindex="-1"><a class="header-anchor" href="#四、javaapi" aria-hidden="true">#</a> 四、JavaAPI</h2><h3 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备" aria-hidden="true">#</a> 环境准备</h3><ol><li><div class="language-pom ext-pom"><pre class="language-pom"><code>    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.11&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
            &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;
            &lt;version&gt;7.8.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
            &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;
            &lt;version&gt;7.8.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;
            &lt;version&gt;2.8.2&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre></div></li><li><p>在代码中创建ES客户端对象，连接ES服务，因为早期版本的客户端对象不再推荐使用，所以我们这里采用高级REST客户端对象。</p></li></ol><h3 id="客户端配置" tabindex="-1"><a class="header-anchor" href="#客户端配置" aria-hidden="true">#</a> 客户端配置</h3><ol><li><p>创建客户端，连接ES服务</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ESClientConfig</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RestHighLevelClient</span> <span class="token function">getESClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建ES客户端</span>
        <span class="token class-name">RestClientBuilder</span> restClientBuilder <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestHighLevelClient</span> esClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>restClientBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> esClient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>连接服务</p><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RestHighLevelClient</span> esClient <span class="token operator">=</span> <span class="token class-name">ESClientConfig</span><span class="token punctuation">.</span><span class="token function">getESClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>esClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="索引操作-1" tabindex="-1"><a class="header-anchor" href="#索引操作-1" aria-hidden="true">#</a> 索引操作</h3><h4 id="创建索引-1" tabindex="-1"><a class="header-anchor" href="#创建索引-1" aria-hidden="true">#</a> 创建索引</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RestHighLevelClient</span> esClient <span class="token operator">=</span> <span class="token class-name">ESClientConfig</span><span class="token punctuation">.</span><span class="token function">getESClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CreateIndexRequest</span> createIndexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">CreateIndexResponse</span> createIndexResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createIndexRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//打印响应状态</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>createIndexResponse<span class="token punctuation">.</span><span class="token function">isAcknowledged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="查询索引" tabindex="-1"><a class="header-anchor" href="#查询索引" aria-hidden="true">#</a> 查询索引</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GetIndexRequest</span> getIndexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestHighLevelClient</span> esClient <span class="token operator">=</span> <span class="token class-name">ESClientConfig</span><span class="token punctuation">.</span><span class="token function">getESClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">GetIndexResponse</span> getIndexResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>getIndexRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>getIndexResponse<span class="token punctuation">.</span><span class="token function">getAliases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>getIndexResponse<span class="token punctuation">.</span><span class="token function">getMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>getIndexResponse<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="删除索引-1" tabindex="-1"><a class="header-anchor" href="#删除索引-1" aria-hidden="true">#</a> 删除索引</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DeleteIndexRequest</span> deleteIndexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteIndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestHighLevelClient</span> esClient <span class="token operator">=</span> <span class="token class-name">ESClientConfig</span><span class="token punctuation">.</span><span class="token function">getESClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">AcknowledgedResponse</span> delete <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>deleteIndexRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="文档操作-1" tabindex="-1"><a class="header-anchor" href="#文档操作-1" aria-hidden="true">#</a> 文档操作</h3><h4 id="添加文档" tabindex="-1"><a class="header-anchor" href="#添加文档" aria-hidden="true">#</a> 添加文档</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">IndexRequest</span> userIndexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userIndexRequest<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ES提供RESTful API进行数据的操作，Java客户端同样需要提供json格式的requestBody</span>
        <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userJson <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        userIndexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>userJson<span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IndexResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>userIndexRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="修改数据" tabindex="-1"><a class="header-anchor" href="#修改数据" aria-hidden="true">#</a> 修改数据</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">UpdateRequest</span> userUpdateRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpdateRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userUpdateRequest<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userUpdateRequest<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">,</span> <span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UpdateResponse</span> updateResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>userUpdateRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>updateResponse<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="查询数据" tabindex="-1"><a class="header-anchor" href="#查询数据" aria-hidden="true">#</a> 查询数据</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span>  <span class="token punctuation">{</span>
        <span class="token class-name">GetRequest</span> getRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        getRequest<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GetResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>getRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> res <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="删除数据" tabindex="-1"><a class="header-anchor" href="#删除数据" aria-hidden="true">#</a> 删除数据</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">DeleteRequest</span> deleteRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deleteRequest<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeleteResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>deleteRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="批量文档操作" tabindex="-1"><a class="header-anchor" href="#批量文档操作" aria-hidden="true">#</a> 批量文档操作</h3><h4 id="批量插入" tabindex="-1"><a class="header-anchor" href="#批量插入" aria-hidden="true">#</a> 批量插入</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bulkInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">BulkRequest</span> bulkRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BulkRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IndexRequest</span> indexRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ES提供RESTful API进行数据的操作，Java客户端同样需要提供json格式的requestBody</span>
        indexRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bulkRequest<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>indexRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IndexRequest</span> indexRequest2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        indexRequest2<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bulkRequest<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>indexRequest2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BulkResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span>bulkRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getTook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>把之前的indexRequest放进BulkRequest里。</p></li></ol><h4 id="批量删除" tabindex="-1"><a class="header-anchor" href="#批量删除" aria-hidden="true">#</a> 批量删除</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bulkDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">BulkRequest</span> bulkRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BulkRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bulkRequest<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DeleteRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bulkRequest<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DeleteRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;1002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BulkResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span>bulkRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getTook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="条件查询-1" tabindex="-1"><a class="header-anchor" href="#条件查询-1" aria-hidden="true">#</a> 条件查询</h3><h4 id="查询所有数据" tabindex="-1"><a class="header-anchor" href="#查询所有数据" aria-hidden="true">#</a> 查询所有数据</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">docQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构造查询条件</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="指定字段查询" tabindex="-1"><a class="header-anchor" href="#指定字段查询" aria-hidden="true">#</a> 指定字段查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">docQuery1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构造查询条件</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="分页查询-1" tabindex="-1"><a class="header-anchor" href="#分页查询-1" aria-hidden="true">#</a> 分页查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">docQuery2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构造查询条件</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="查询结果排序" tabindex="-1"><a class="header-anchor" href="#查询结果排序" aria-hidden="true">#</a> 查询结果排序</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sourceBuilder<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token class-name">SortOrder</span><span class="token punctuation">.</span>DESC<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol><h4 id="返回指定字段-1" tabindex="-1"><a class="header-anchor" href="#返回指定字段-1" aria-hidden="true">#</a> 返回指定字段</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> excludes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> includes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
sourceBuilder<span class="token punctuation">.</span><span class="token function">fetchSource</span><span class="token punctuation">(</span>includes<span class="token punctuation">,</span> excludes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol><h3 id="高级查询" tabindex="-1"><a class="header-anchor" href="#高级查询" aria-hidden="true">#</a> 高级查询</h3><h4 id="组合查询" tabindex="-1"><a class="header-anchor" href="#组合查询" aria-hidden="true">#</a> 组合查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>        <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol><h4 id="范围查询-1" tabindex="-1"><a class="header-anchor" href="#范围查询-1" aria-hidden="true">#</a> 范围查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>        <span class="token class-name">RangeQueryBuilder</span> rangeQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rangeQueryBuilder<span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rangeQueryBuilder<span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>rangeQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol><h4 id="模糊查询" tabindex="-1"><a class="header-anchor" href="#模糊查询" aria-hidden="true">#</a> 模糊查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>        <span class="token class-name">FuzzyQueryBuilder</span> fuzzyQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">fuzzyQuery</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fuzziness</span><span class="token punctuation">(</span><span class="token class-name">Fuzziness</span><span class="token punctuation">.</span>ONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>fuzzyQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>fuzziness表示偏差的距离，即差几个字符能被查出来</p></li></ol><h4 id="高亮查询" tabindex="-1"><a class="header-anchor" href="#高亮查询" aria-hidden="true">#</a> 高亮查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TermQueryBuilder</span> termQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>termQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HighlightBuilder</span> highlightBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        highlightBuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">highlighter</span><span class="token punctuation">(</span>highlightBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol><h4 id="聚合查询" tabindex="-1"><a class="header-anchor" href="#聚合查询" aria-hidden="true">#</a> 聚合查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aggrQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构造查询条件</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//由于是聚合，这里使用的是AggregationBuilder。maxAge，</span>
        <span class="token comment">// age，也就是要在该字段中聚合出最大值</span>
        <span class="token class-name">AggregationBuilder</span> aggregationBuilder <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string">&quot;maxAge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>aggregationBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Max</span> maxAge <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;maxAge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>maxAge<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;--&quot;</span> <span class="token operator">+</span> maxAge<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> maxAge<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h4 id="分组查询" tabindex="-1"><a class="header-anchor" href="#分组查询" aria-hidden="true">#</a> 分组查询</h4><ol><li><div class="language-java ext-java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">groupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchRequest</span> searchRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构造查询条件</span>
        <span class="token class-name">SearchSourceBuilder</span> sourceBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 分组</span>
        <span class="token class-name">AggregationBuilder</span> aggregationBuilder <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;ageGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sourceBuilder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>aggregationBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        searchRequest<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>sourceBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Terms</span> terms <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ageGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> b<span class="token operator">:</span> terms<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> b<span class="token punctuation">.</span><span class="token function">getDocCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        esClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ol><h2 id="五、es环境" tabindex="-1"><a class="header-anchor" href="#五、es环境" aria-hidden="true">#</a> 五、ES环境</h2><h3 id="概述-1" tabindex="-1"><a class="header-anchor" href="#概述-1" aria-hidden="true">#</a> 概述</h3><ol><li><p>单机的容量是有限的，为了避免出现单点故障，企业一般都是采用集群部署的方式。</p><p>生产环境中，一般都是运行再指定服务器集群中。</p></li><li><p>单机服务器问题：</p><ul><li>负载会过高</li><li>存储容量有限</li><li>无法实现高可用</li><li>并发处理能力有限</li></ul></li><li><p>集群是把多个节点当成整体提供服务，分布式可以认为是思想，集群是物理层面的，是多台服务器节点组成一个集群，对外提供服务。</p><p>一个个不同微服务就部署在这多个服务器节点上；同一个微服务项目，采用分布式部署的方式，避免单点故障。</p></li><li><p>配置服务器集群时，集群中节点数量大于等于2就可以认为是集群了。</p><p>一个集群就是多个服务器节点（在kafka中这个概念是broker），共同持有整个的数据，并一起提供索引和搜索功能。</p><p>一个elasticsearch集群有一个唯一的名字标识，整个名字默认就是“elasticsearch”，一个节点只能通过指定某个集群的名字，来加入这个集群。</p></li></ol><h3 id="节点" tabindex="-1"><a class="header-anchor" href="#节点" aria-hidden="true">#</a> 节点</h3><ol><li><p>集群中包含很多服务器，一个节点就是其中的一个服务器，<strong>作为集群的一部分，它存储数据，参与集群的索引和搜索功能。</strong></p></li><li><p>一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威角色名字，这个名字会在启动的时候赋予节点。</p><p>这个名字对于管理工作来说很重要，因为在管理过程中，会去确定网络中的哪些服务器对应于ES集群中的哪些节点。</p><p>一个节点可以通过配置集群名称的方式来加入一个指定集群，默认情况下，每个节点都会被安排加入一个叫做“elasticsearch”的集群中。</p></li><li><p><strong>多个服务器节点就形成了一个服务器集群，但是是不是一个节点就是一个服务器，一个独立的电脑呢？不是的，一台服务器上也可以启动多个节点，模拟集群，但是生产环境是不会这么做的，因为集群的目的之一就是为了避免单点故障。</strong></p></li></ol><h3 id="win集群部署" tabindex="-1"><a class="header-anchor" href="#win集群部署" aria-hidden="true">#</a> WIN集群部署</h3><h4 id="修改配置" tabindex="-1"><a class="header-anchor" href="#修改配置" aria-hidden="true">#</a> 修改配置</h4><p>第一台</p><ol><li><p>配置集群</p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token comment"># ---------------------------------- Cluster -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Use a descriptive name for your cluster:</span>
<span class="token comment">#</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>application
<span class="token comment">#</span>
</code></pre></div><p>节点以集群名称作为标识来加入集群</p></li><li><p>配置节点</p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token comment"># ------------------------------------ Node ------------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Use a descriptive name for the node:</span>
<span class="token comment">#</span>
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">1001</span>
<span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment">#</span>
<span class="token comment"># Add custom attributes to the node:</span>
<span class="token comment">#</span>
<span class="token comment">#node.attr.rack: r1</span>
<span class="token comment">#</span>
</code></pre></div><p>配置节点名称，节点是否是master等</p></li><li><p>配置网络</p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token comment"># ---------------------------------- Network -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span>
<span class="token comment">#</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> localhost
<span class="token comment">#</span>
<span class="token comment"># Set a custom port for HTTP:</span>
<span class="token comment">#</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">1001</span>
<span class="token key atrule">transport.tcp.port</span><span class="token punctuation">:</span> <span class="token number">9301</span>
<span class="token comment">#</span>
<span class="token comment"># For more information, consult the network module documentation.</span>
<span class="token comment">#</span>
</code></pre></div></li><li><p>跨域配置</p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token comment"># ---------------------------------- Various -----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Require explicit names when deleting indices:</span>
<span class="token comment">#</span>
<span class="token comment">#action.destructive_requires_name: true</span>
<span class="token key atrule">http.cors.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">http.cors.allow-origin</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
</code></pre></div></li></ol><p>第二台</p><ol><li><p>除了以上四点配置</p><p>增加discovery配置，<strong>要去发现集群的其他节点，建立连接！</strong></p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token comment"># --------------------------------- Discovery ----------------------------------</span>
<span class="token comment">#</span>
<span class="token comment"># Pass an initial list of hosts to perform discovery when this node is started:</span>
<span class="token comment"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span>
<span class="token comment">#</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost:9301&quot;</span><span class="token punctuation">]</span>
<span class="token key atrule">discovery.zen.fd.ping_timeout</span><span class="token punctuation">:</span> 1m
<span class="token key atrule">discovery.zen.fd.ping_retries</span><span class="token punctuation">:</span> <span class="token number">5</span>
</code></pre></div><p>localhost:9301是<strong>内部通信端口</strong>，前面配置的http.port: 1001是<strong>对外的http服务地址！！</strong></p></li></ol><h4 id="查询节点状态" tabindex="-1"><a class="header-anchor" href="#查询节点状态" aria-hidden="true">#</a> 查询节点状态</h4><ol><li><p><code>GET http://localhost:1001/_cluster/health</code></p><p>响应：</p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;cluster_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-application&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timed_out&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;number_of_nodes&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;number_of_data_nodes&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;active_primary_shards&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;active_shards&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;relocating_shards&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;initializing_shards&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;unassigned_shards&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;delayed_unassigned_shards&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;number_of_pending_tasks&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;number_of_in_flight_fetch&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;task_max_waiting_in_queue_millis&quot;</span><span class="token operator">:</span> <span class="token number">45286</span><span class="token punctuation">,</span>
    <span class="token property">&quot;active_shards_percent_as_number&quot;</span><span class="token operator">:</span> <span class="token number">100.0</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="linux单点部署" tabindex="-1"><a class="header-anchor" href="#linux单点部署" aria-hidden="true">#</a> Linux单点部署</h3><h4 id="修改配置-1" tabindex="-1"><a class="header-anchor" href="#修改配置-1" aria-hidden="true">#</a> 修改配置</h4><ol><li><p>config目录下的elasticsearch.yml文件</p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token comment">#集群名称、节点名称、对外地址和port</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> elasticsearch
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 0.0.0.0
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">]</span> <span class="token comment">#把当前机器当作主节点。</span>
</code></pre></div></li></ol><h3 id="linux集群部署" tabindex="-1"><a class="header-anchor" href="#linux集群部署" aria-hidden="true">#</a> Linux集群部署</h3><h4 id="修改配置-2" tabindex="-1"><a class="header-anchor" href="#修改配置-2" aria-hidden="true">#</a> 修改配置</h4><p>第一台</p><ol><li><p>config目录下的elasticsearch.yml文件</p><div class="language-yaml ext-yml"><pre class="language-yaml"><code><span class="token comment"># 集群名称</span>
<span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>es
<span class="token comment"># 节点名称，每个节点的名称不能重复</span>
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token comment"># ip地址，每个节点的ip地址不能重复</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 192.168.15.214
<span class="token comment"># 该节点是不是有资格主节点</span>
<span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9201</span>
<span class="token key atrule">http.cors.allow-origin</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
<span class="token key atrule">http.cors.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">http.max_content_length</span><span class="token punctuation">:</span> 200mb
<span class="token comment"># es7.x之后新增的配置，初始化一个新的集群时需要此配置来选举master</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># 节点发现，内部通信端口</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.15.214:9301&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.15.214:9302&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;192.168.15.214:9303&quot;</span><span class="token punctuation">]</span>
<span class="token key atrule">gateway.recover_after_nodes</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">network.tcp.keep_alive</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">network.tcp.no_delay</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">transport.tcp.compress</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment"># 集群内同时启动的数据任务个数，默认是2个</span>
<span class="token key atrule">cluster.routing.allocation.cluster_concurrent_rebalance</span><span class="token punctuation">:</span> <span class="token number">16</span>
<span class="token comment"># 添加或删除节点及负载均衡时并发恢复的线程个数，默认4个</span>
<span class="token key atrule">cluster.routing.allocation.node_concurrent_recoveries</span><span class="token punctuation">:</span> <span class="token number">16</span>
<span class="token comment"># 初始化数据恢复时，并发恢复线程的个数，默认4个</span>
<span class="token key atrule">cluster.routing.allocation.node_initial_primaries_recoveries</span><span class="token punctuation">:</span> <span class="token number">16</span>
</code></pre></div><p>其余两个服务器节点也按照此配置，要修改端口，节点名称等</p></li></ol><h2 id="六、es进阶" tabindex="-1"><a class="header-anchor" href="#六、es进阶" aria-hidden="true">#</a> 六、ES进阶</h2><h3 id="核心概念" tabindex="-1"><a class="header-anchor" href="#核心概念" aria-hidden="true">#</a> 核心概念</h3><ol><li><p>索引（Index）</p><p>一个索引就是一个拥有几分相似特征的文档的集合，或者说数据集合，一个索引就对应于关系型数据库的<strong>一个数据库或者一个数据表</strong>，索引中的文档就是一条数据。</p><p>一个索引由一个名字来标识，必须全是小写字母，并且当我们对这个索引中的文档即数据进行CRUD时，都要用到这个名字。</p><p>能搜索的数据必须索引，这样的好处是提高查询速度。</p></li><li><p>类型（Type）</p><p>Type的概念原先可以理解为对应于关系型数据库的数据表，但是现在已经弃用这个概念了，因为索引能直接和数据关联，倒排索引也是Lucene这个全文检索引擎的特性，keyword索引能和文档关联起来，也就是数据，所以在索引和数据之间不应该再多一个概念。</p></li><li><p>文档（Document）</p><p>一个文档就是一条数据</p><p>在一个index（数据库）里能存储任意多的文档</p><p>一个文档为一条数据，也就是MySQL中的一行数据，一个表中有多行数据，而ES中，一个索引中有多条数据，所以表对应于索引。</p><p>表能和对象进行映射，在ES中，Index和对象进行映射，一个Index中的数据的字段结构都是相同的。</p></li><li><p>分片（shards）</p><p>一个索引可以存储超过单个节点硬件限制的大量数据。ES提供了将<strong>索引划分成多份</strong>的能力，每一份索引就成为分片，shard。</p><p>当你创建<strong>一个索引</strong>的时候，你可以指定你想要的分片的数量。<strong>每一个分片放在不同的服务器节点上提供服务。</strong></p><p>至于一个分片怎样分布，它的文档怎样聚合和搜索请求，是完全由ES管理的，对用户透明，无需过分关心。</p></li><li><p>副本（Replicas）</p><p>在一个网络/云的环境里，失败随时都可能发生，在某个分片/节点由于故障处于离线状态，这种情况下有一个故障转移机制是非常有用的。ES允许你创建分片的一份或多份拷贝，这些拷贝叫做副本。</p><p>作用：</p><ul><li>提供了高可用性，副本分片从不与原主分片置于同一服务器节点。</li><li>提高吞吐量，因为搜索可以在所有的副本上并行运行。</li></ul></li></ol><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 64005626+shaileneF@users.noreply.github.com">shailene</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/study/assets/app.4e5a7100.js" defer></script>
  </body>
</html>
