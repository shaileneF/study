<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.45">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/icon/111.ico"><title>Gin | shAilene</title><meta name="description" content="just be simple.">
    <link rel="modulepreload" href="/study/assets/app.8fb9e4f4.js"><link rel="modulepreload" href="/study/assets/gin.html.48f1d5fe.js"><link rel="modulepreload" href="/study/assets/gin.html.a592fddc.js"><link rel="prefetch" href="/study/assets/index.html.10d86c32.js"><link rel="prefetch" href="/study/assets/index.html.db04f056.js"><link rel="prefetch" href="/study/assets/index.html.4d16550e.js"><link rel="prefetch" href="/study/assets/index.html.e81d92f2.js"><link rel="prefetch" href="/study/assets/golang.html.425bbb4f.js"><link rel="prefetch" href="/study/assets/gorm.html.6377b104.js"><link rel="prefetch" href="/study/assets/Javaweb.html.47fa7ea3.js"><link rel="prefetch" href="/study/assets/ES.html.399daaba.js"><link rel="prefetch" href="/study/assets/一些知识点的记录.html.ee45bf60.js"><link rel="prefetch" href="/study/assets/Java笔记.html.b7927111.js"><link rel="prefetch" href="/study/assets/dubbo.html.2d737de1.js"><link rel="prefetch" href="/study/assets/springcloud（上）.html.55049bdd.js"><link rel="prefetch" href="/study/assets/springcloud（下）.html.aae84aed.js"><link rel="prefetch" href="/study/assets/zookeeper.html.9cd56b83.js"><link rel="prefetch" href="/study/assets/《并发编程的艺术》笔记.html.bbc8c1aa.js"><link rel="prefetch" href="/study/assets/并发编程.html.2403bde8.js"><link rel="prefetch" href="/study/assets/尚硅谷_宋红康_JDBC.html.81cb2213.js"><link rel="prefetch" href="/study/assets/redis.html.e5bc3310.js"><link rel="prefetch" href="/study/assets/Mybatis.html.5cdfe464.js"><link rel="prefetch" href="/study/assets/spring.html.c676e225.js"><link rel="prefetch" href="/study/assets/springboot.html.e29cb6a4.js"><link rel="prefetch" href="/study/assets/springboot.html.ceb745cc.js"><link rel="prefetch" href="/study/assets/springMVC.html.1f3630e7.js"><link rel="prefetch" href="/study/assets/kafka.html.a78bc3b1.js"><link rel="prefetch" href="/study/assets/RabbitMQ.html.f122a596.js"><link rel="prefetch" href="/study/assets/操作系统.html.0c991d74.js"><link rel="prefetch" href="/study/assets/flink基本篇.html.ff528c1a.js"><link rel="prefetch" href="/study/assets/flink基本篇2.html.62419ca9.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第一部分.html.ea3a304d.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第二部分.html.9c87038d.js"><link rel="prefetch" href="/study/assets/404.html.93146c89.js"><link rel="prefetch" href="/study/assets/index.html.186607ee.js"><link rel="prefetch" href="/study/assets/index.html.427489b4.js"><link rel="prefetch" href="/study/assets/index.html.1c61d5e7.js"><link rel="prefetch" href="/study/assets/index.html.e1372642.js"><link rel="prefetch" href="/study/assets/golang.html.7e69d4a3.js"><link rel="prefetch" href="/study/assets/gorm.html.08bda09c.js"><link rel="prefetch" href="/study/assets/Javaweb.html.57f21724.js"><link rel="prefetch" href="/study/assets/ES.html.46a070ef.js"><link rel="prefetch" href="/study/assets/一些知识点的记录.html.33f5bfe4.js"><link rel="prefetch" href="/study/assets/Java笔记.html.f3f64281.js"><link rel="prefetch" href="/study/assets/dubbo.html.4d78d1ca.js"><link rel="prefetch" href="/study/assets/springcloud（上）.html.20ca112a.js"><link rel="prefetch" href="/study/assets/springcloud（下）.html.c1436040.js"><link rel="prefetch" href="/study/assets/zookeeper.html.7ad6ab20.js"><link rel="prefetch" href="/study/assets/《并发编程的艺术》笔记.html.d6cfd023.js"><link rel="prefetch" href="/study/assets/并发编程.html.99ae0a3e.js"><link rel="prefetch" href="/study/assets/尚硅谷_宋红康_JDBC.html.29e6971b.js"><link rel="prefetch" href="/study/assets/redis.html.ac431424.js"><link rel="prefetch" href="/study/assets/Mybatis.html.cafbfd63.js"><link rel="prefetch" href="/study/assets/spring.html.ab342994.js"><link rel="prefetch" href="/study/assets/springboot.html.06fecdc4.js"><link rel="prefetch" href="/study/assets/springboot.html.9badea97.js"><link rel="prefetch" href="/study/assets/springMVC.html.6bcc446a.js"><link rel="prefetch" href="/study/assets/kafka.html.92d30ad2.js"><link rel="prefetch" href="/study/assets/RabbitMQ.html.9ac133dd.js"><link rel="prefetch" href="/study/assets/操作系统.html.82e05396.js"><link rel="prefetch" href="/study/assets/flink基本篇.html.0d57e63c.js"><link rel="prefetch" href="/study/assets/flink基本篇2.html.995f74e6.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第一部分.html.e74afe12.js"><link rel="prefetch" href="/study/assets/MySQL数据库笔记-第二部分.html.7bdf1b88.js"><link rel="prefetch" href="/study/assets/404.html.ba81f23b.js"><link rel="prefetch" href="/study/assets/404.b7c98023.js"><link rel="prefetch" href="/study/assets/Layout.c728901b.js">
    <link rel="stylesheet" href="/study/assets/style.2bba04cf.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/study/" class=""><img class="logo" src="/study/images/leo.jpg" alt="shAilene"><span class="site-name can-hide">shAilene</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/study/java/" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/go/" class="router-link-active" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/mw/" class="" aria-label="中间件"><!--[--><!--]--> 中间件 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/study/java/" class="" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/go/" class="router-link-active" aria-label="Go"><!--[--><!--]--> Go <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></div><div class="navbar-item"><a href="/study/mw/" class="" aria-label="中间件"><!--[--><!--]--> 中间件 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Gin <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/go/gin/gin.html#一、hello-world" class="router-link-active router-link-exact-active sidebar-item" aria-label="一、Hello World"><!--[--><!--]--> 一、Hello World <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#二、返回响应类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="二、返回响应类型"><!--[--><!--]--> 二、返回响应类型 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/go/gin/gin.html#拼接json" class="router-link-active router-link-exact-active sidebar-item" aria-label="拼接JSON"><!--[--><!--]--> 拼接JSON <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#结构体" class="router-link-active router-link-exact-active sidebar-item" aria-label="结构体"><!--[--><!--]--> 结构体 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/go/gin/gin.html#三、接收参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="三、接收参数"><!--[--><!--]--> 三、接收参数 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/go/gin/gin.html#接收querystring参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="接收querystring参数"><!--[--><!--]--> 接收querystring参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#接收表单参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="接收表单参数"><!--[--><!--]--> 接收表单参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#获取path参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="获取Path参数"><!--[--><!--]--> 获取Path参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#参数绑定" class="router-link-active router-link-exact-active sidebar-item" aria-label="参数绑定"><!--[--><!--]--> 参数绑定 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/go/gin/gin.html#四、路由及控制器" class="router-link-active router-link-exact-active sidebar-item" aria-label="四、路由及控制器"><!--[--><!--]--> 四、路由及控制器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#五、中间件" class="router-link-active router-link-exact-active sidebar-item" aria-label="五、中间件"><!--[--><!--]--> 五、中间件 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/go/gin/gin.html#简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="简介"><!--[--><!--]--> 简介 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#定义" class="router-link-active router-link-exact-active sidebar-item" aria-label="定义"><!--[--><!--]--> 定义 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#注册" class="router-link-active router-link-exact-active sidebar-item" aria-label="注册"><!--[--><!--]--> 注册 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="应用"><!--[--><!--]--> 应用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/study/go/gin/gin.html#注意" class="router-link-active router-link-exact-active sidebar-item" aria-label="注意"><!--[--><!--]--> 注意 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/study/go/gin/gin.html#六、model" class="router-link-active router-link-exact-active sidebar-item" aria-label="六、Model"><!--[--><!--]--> 六、Model <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/study/go/gin/gin.html#概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="概述"><!--[--><!--]--> 概述 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="gin" tabindex="-1"><a class="header-anchor" href="#gin" aria-hidden="true">#</a> Gin</h1><h2 id="一、hello-world" tabindex="-1"><a class="header-anchor" href="#一、hello-world" aria-hidden="true">#</a> 一、Hello World</h2><ul><li>创建一个默认的路由引擎</li><li>配置路由，通过回调函数处理请求</li><li>启动web服务</li></ul><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 创建一个默认的路由引擎</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 配置路由</span>
	<span class="token comment">// 这个路由的作用就是用来接收请求，GET|POST|PUT|DELETE</span>
	<span class="token comment">// 第一个参数为请求路径，第二个参数为这个请求的回调函数</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/news&quot;</span><span class="token punctuation">,</span> test1<span class="token punctuation">)</span>
	<span class="token comment">// 启动一个web服务</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 给浏览器或者说给客户端返回对应的响应</span>
	c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">test1</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;news!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>这里的c.String就是说这个web服务返回给客户端、浏览器、前端的响应，这里是String，那么返回给前端的是字符串，但是在开发中，绝大多数情况采用前后端分离的开发方式，<strong>前端需要后端返回的大多数是JSON格式的数据，后端服务接收的前端发过来的参数也大多数是组装好的JSON格式的数据。</strong></p><p>如果这里返回响应是JSON格式，那么就是c.JSON</p><p>在Java的springmvc中，一般都是返回对象，即加注解@ResponseBody + @Controller或者@RestController。</p><p>加了以上注解之后，代表响应的不是视图，而是数据，返回的是数据。</p><p>若控制器方法返回值类型是对象，那么这个对象会被转换为JSON格式的字符串，返回给前端，就和这里c.JSON一样了。</p><p>为什么返回的对象会被转换成JSON格式的字符串，这就是HttpMessageConverter的作用，这是springMVC的知识，大致就是因为返回的对象，这个对象如何处理？会依次调用HttpMessageConverter接口的实现类的canWrite()方法，找到能够处理对象的canWrite方法，并进而调用write方法。对象默认转换成JSON格式而不是XML格式。</p><p><strong>springmvc也可以用一个对象来接收请求参数，这就是说明前后端交互数据是json格式是一样的。在gin这边也是一样的。</strong></p><h2 id="二、返回响应类型" tabindex="-1"><a class="header-anchor" href="#二、返回响应类型" aria-hidden="true">#</a> 二、返回响应类型</h2><p>web开发主要的两种模式</p><ol><li>前后端不分离：客户端浏览器直接向服务器发送请求，服务器会把整个完整的HTML页面的内容返回给客户端</li><li>前后端分离：前端有自己的框架，向后端发送请求之后，后端服务程序只需要给前端返回JSON格式的响应，前端拿到响应之后自己去做渲染。</li></ol><h3 id="拼接json" tabindex="-1"><a class="header-anchor" href="#拼接json" aria-hidden="true">#</a> 拼接JSON</h3><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// gin.H 是map[string]interface{}的缩写</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/someJSON&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 方式一：自己拼接JSON</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="结构体" tabindex="-1"><a class="header-anchor" href="#结构体" aria-hidden="true">#</a> 结构体</h3><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/moreJSON&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 方法二：使用结构体</span>
		<span class="token keyword">var</span> msg <span class="token keyword">struct</span> <span class="token punctuation">{</span>
			Name    <span class="token builtin">string</span> <span class="token string">`json:&quot;user&quot;`</span>
			Message <span class="token builtin">string</span>
			Age     <span class="token builtin">int</span>
		<span class="token punctuation">}</span>
		msg<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;小王子&quot;</span>
		msg<span class="token punctuation">.</span>Message <span class="token operator">=</span> <span class="token string">&quot;Hello world!&quot;</span>
		msg<span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">18</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="三、接收参数" tabindex="-1"><a class="header-anchor" href="#三、接收参数" aria-hidden="true">#</a> 三、接收参数</h2><h3 id="接收querystring参数" tabindex="-1"><a class="header-anchor" href="#接收querystring参数" aria-hidden="true">#</a> 接收querystring参数</h3><p>querystring指的是URL中?后面携带的参数，例如：/user/search?username=小王子&amp;address=沙河。 获取请求的querystring参数的方法如下：</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//Default返回一个默认的路由引擎</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/user/search&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// DefaultQuery取不到参数值时指定的默认值</span>
		<span class="token comment">//username := c.DefaultQuery(&quot;username&quot;, &quot;小王子&quot;)</span>
		username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
		address <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span>
		<span class="token comment">//输出json结果给调用方</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
			<span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>
			<span class="token string">&quot;address&quot;</span><span class="token punctuation">:</span>  address<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="接收表单参数" tabindex="-1"><a class="header-anchor" href="#接收表单参数" aria-hidden="true">#</a> 接收表单参数</h3><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//Default返回一个默认的路由引擎</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">&quot;/user/search&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// DefaultPostForm取不到值时指定的默认值</span>
		<span class="token comment">//username := c.DefaultPostForm(&quot;username&quot;, &quot;小王子&quot;)</span>
		username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
		address <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span>
		<span class="token comment">//输出json结果给调用方</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
			<span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>
			<span class="token string">&quot;address&quot;</span><span class="token punctuation">:</span>  address<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="获取path参数" tabindex="-1"><a class="header-anchor" href="#获取path参数" aria-hidden="true">#</a> 获取Path参数</h3><p>请求的参数通过URL路径传递，获取请求URL路径中的参数的方式如下：</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//Default返回一个默认的路由引擎</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/user/search/:username/:address&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
		address <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span>
		<span class="token comment">//输出json结果给调用方</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
			<span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span>  <span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>
			<span class="token string">&quot;address&quot;</span><span class="token punctuation">:</span>  address<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="参数绑定" tabindex="-1"><a class="header-anchor" href="#参数绑定" aria-hidden="true">#</a> 参数绑定</h3><p>结构体定义如下：</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">type</span> Userinfo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Username <span class="token builtin">string</span> <span class="token string">`form:&quot;username&quot; json:&quot;user&quot;`</span>
	Password <span class="token builtin">string</span> <span class="token string">`form:&quot;password&quot; json:&quot;password&quot;`</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个结构体定义表明了结构体的字段和表单的什么字段对应，和json的什么字段对应。</p><p>这就相当于Java的springmvc中的用一个对象来接收请求参数。</p><p>在这里就是用结构体来接收请求参数。</p><p>不管是GET请求写在浏览器地址栏的参数还是表单参数，还是前端发过来的JSON字符串(RequestBody)，都能绑定到结构体上，<strong>也就是都能用一个对象来接收请求参数！！</strong></p><p>绑定JSON requestbody</p><div class="language-go ext-go"><pre class="language-go"><code>router<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">&quot;/loginJSON&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> login Login

		<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;login info:%#v\n&quot;</span><span class="token punctuation">,</span> login<span class="token punctuation">)</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
				<span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span>     login<span class="token punctuation">.</span>User<span class="token punctuation">,</span>
				<span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span> login<span class="token punctuation">.</span>Password<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="四、路由及控制器" tabindex="-1"><a class="header-anchor" href="#四、路由及控制器" aria-hidden="true">#</a> 四、路由及控制器</h2><ol><li>路由要分组，并且要将路由文件抽离。</li><li>除了要将路由文件抽离，控制器方法也要单独写，也就是说在gin框架中，最好是分为四层，即路由层，controller层，service层，dao层。</li><li>controller层即控制器方法，这一层接收参数，和springmvc的controller层一样，只不过Java的SSM框架，在controller层，通过@RequestMapping，@GetMapping等注解来控制访问地址，一个路径对应于一个调用方法，没有将路由单独分层。在gin框架中，将路由和控制器方法进行了解耦，路由层专门用来处理路由，做路由分组等，<strong>而controller层接收参数，调用业务层（service）逻辑，返回响应。</strong></li></ol><h2 id="五、中间件" tabindex="-1"><a class="header-anchor" href="#五、中间件" aria-hidden="true">#</a> 五、中间件</h2><h3 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h3><ol><li><p>Gin框架允许开发者在处理请求的过程中，加入用户自己的钩子（Hook）函数，这个<strong>钩子函数就叫做中间件。</strong></p><p>中间件适合处理一些公共的业务逻辑，比如登录认证、权限校验、数据分页、<strong>记录日志</strong>、耗时统计等。</p><p><img src="/study/assets/image-20220811114543114.9f1a901b.png" alt="image-20220811114543114"></p></li><li><p>Gin的中间件必须是一个gin.HandlerFunc类型。</p><p>例如我们像下面的代码一样定义一个统计请求耗时的中间件。</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">StatCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xiaowangzi&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 可以通过c.Set在请求上下文中设置值，后续的处理函数能够取到该值</span>
		<span class="token comment">// 调用该请求的剩余处理程序</span>
        <span class="token comment">// c.Next()以后的程序会在路由匹配并处理之后再执行, 所以这里的意思是在c.Next()之前计算一个时间，然后进行业务逻辑处理，处理完成之后，再执行c.Next()之后的逻辑，即计算业务逻辑所花时间</span>
		c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// 不调用该请求的剩余处理程序</span>
		<span class="token comment">// c.Abort()</span>
		cost <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-go ext-go"><pre class="language-go"><code><span class="token comment">// M1 定义一个中间件m1， 可以看到和上面那种写法不一样，但是仍然是一个中间件，因为这个函数的类型就是gin.HandlerFunc</span>
<span class="token keyword">func</span> <span class="token function">M1</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;m1 in .....&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>配置路由的时候可以传递多个回调函数，</p><p><strong>最后一个func回调函数前面触发的方法都可以称为中间件。</strong></p><p><strong>最后一个回调函数就是这个路由的处理程序。</strong></p></li><li><p>c.Next()可以调用请求的剩余处理程序</p><p>中间件里加上c.Next()可以让我们在路由匹配完成后执行一些操作。</p><p><strong>c.Next()以后的程序会在匹配路由所对应的业务逻辑处理之后再执行。</strong></p><p>所以中间件也可以理解为匹配路由之前和匹配路由之后执行的一系列操作。</p><p>中间件逻辑----匹配路由以及执行对应的匹配路由逻辑----中间件逻辑。</p><p>这个是有点像springMVC中的拦截器：</p><ul><li>在请求处理之前，也就是控制器方法之前会执行拦截器</li><li>在控制器方法执行之后，也会执行拦截器</li><li>在请求处理完成后也会执行拦截器。</li></ul></li><li><p>c.Abort()</p><p><strong>执行中间件中，匹配路由之前的和匹配路由之后的逻辑，而不执行匹配路由本身的逻辑。</strong></p></li></ol><h3 id="定义" tabindex="-1"><a class="header-anchor" href="#定义" aria-hidden="true">#</a> 定义</h3><ol><li><p>中间件定义有两种写法，本质是函数。</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">middleW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token operator">...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//注册一个全局中间件</span>
router<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">middleW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">middleW</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token comment">//注册一个全局中间件</span>
router<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">middleW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li></ol><h3 id="注册" tabindex="-1"><a class="header-anchor" href="#注册" aria-hidden="true">#</a> 注册</h3><ol><li><p>在Gin框架中，我们可以注册全局中间件，<strong>也可以给单独路由或者路由组注册中间件</strong>，可以为路由添加任意数量的中间件。</p></li><li><p>当但存在多个中间件的时候，中间件的处理顺序如下：</p><p><img src="/study/assets/image-20220811141525168.aa5c4c77.png" alt="image-20220811141525168"></p><p><img src="/study/assets/image-20221102153108540.ede7329d.png" alt="image-20221102153108540"></p><p><img src="/study/assets/image-20221102153246434.acd7873a.png" alt="image-20221102153246434"></p></li><li><p>注册全局中间件</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//注册一个全局中间件</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">middleW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法内部&quot;</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
			<span class="token string">&quot;msg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;成功了&quot;</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>单独注册某个路由中间件</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span> <span class="token function">middleW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法内部&quot;</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
			<span class="token string">&quot;msg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;成功了&quot;</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>给路由组注册中间件</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token comment">//定义一个路由组 并注册中间件</span>
v1 <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">middleW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//或者</span>
v1 <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token function">middleW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>三个函数介绍</p><ul><li><p>c.Next()</p><p>表示跳过当前中间件剩余内容， 去执行下一个中间件。 当所有操作执行完之后，以出栈的执行顺序返回，执行中间件的剩余代码。</p></li><li><p>return</p><p>终止执行当前中间件剩余内容，以出栈的顺序执行返回，<strong>但不执行return后的代码。</strong></p><p><img src="/study/assets/image-20221102154809124.4ccaf7dd.png" alt="image-20221102154809124"></p></li><li><p>c.Abort()</p><p><strong>只执行当前中间件， 操作完成后，以出栈的顺序，依次返回上一级中间件</strong>。</p><p>即当前中间件会执行完，但是控制器函数不会执行，也就是如果遇到Abort()，那么就会只<strong>执行到当前函数为止</strong>，然后以出栈的执行顺序返回。把中间件函数也当作控制器函数，如下，把匹配路由的最后一个函数当作控制器函数，控制器函数之前的函数都是中间件，如果某个中间件函数中有c.Abort()，那么就会只执行到那个函数的位置，然后以出栈的顺序即后进先出返回，但是此中间件函数内部的逻辑会执行完！！控制器函数里才是真正调用service层执行业务逻辑的地方。</p><p>Abort就是会把这个函数内部的逻辑执行完，然后以出栈的顺序返回，不再执行下一个中间件了。</p><div class="language-go ext-go"><pre class="language-go"><code>r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span> <span class="token function">middlewOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">middlewTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">middlewThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法内部&quot;</span><span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
		<span class="token string">&quot;msg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;这里是test1&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/study/assets/image-20221102154102149.6c8d17d8.png" alt="image-20221102154102149"></p><div class="language-go ext-go"><pre class="language-go"><code><span class="token comment">//定义中间件1</span>
<span class="token keyword">func</span> <span class="token function">middlewOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法前,我是1&quot;</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法后,我是1&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义中间件2</span>
<span class="token keyword">func</span> <span class="token function">middlewTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法前,我是2&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// Abort就是会把这个函数内部的逻辑执行完，然后以出栈的顺序返回，要是连fmt.Println(&quot;我在方法后,我是2&quot;)都不想执行，就把Abort换成return</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法后,我是2&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义中间件3</span>
<span class="token keyword">func</span> <span class="token function">middlewThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法前,我是3&quot;</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法后,我是3&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//使用多个中间件</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span> <span class="token function">middlewOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">middlewTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">middlewThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;我在方法内部&quot;</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
			<span class="token string">&quot;msg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;这里是test1&quot;</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/study/assets/image-20220811142211372.6411baf1.png" alt="image-20220811142211372"></p></li></ul></li><li><p>在用写gin框架写web服务时，中间件要抽离出来单独写，路由层单独写，控制器方法单独写，业务层单独写。</p></li><li><p>中间件和控制器可以进行数据的传递，在中间件中可以设值，通过c.Set()，在之后的中间件和控制器中可以通过c.Get()获取值。</p></li></ol><h3 id="应用" tabindex="-1"><a class="header-anchor" href="#应用" aria-hidden="true">#</a> 应用</h3><ol><li><p>登录认证</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">authMiddleware</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">/*
   if 登录 {
      c.Next()
   } else {
      c.Abort()
   }
    */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>虽然上面函数的类型（不是返回类型，这个函数的返回类型为void，就是无返回类型）是gin.HandlerFunc，也就是该函数可以直接当作一个中间件函数，但是还是经常把中间件函数写成如下形式。</p><div class="language-go ext-go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">authMiddleware</span><span class="token punctuation">(</span>doCheck <span class="token builtin">bool</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
	<span class="token comment">// 是因为在这里可以做连接数据库或做一些其他准备工作</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> doCheck <span class="token punctuation">{</span>
			<span class="token comment">/*
				if 登录 {
					c.Next()
				} else {
					c.Abort()
				}
			*/</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol><h3 id="注意" tabindex="-1"><a class="header-anchor" href="#注意" aria-hidden="true">#</a> 注意</h3><ol><li><p>gin.Default()默认使用了Logger和Recovery中间件，其中：</p><ul><li><p>Logger中间件将日志写入gin.DefaultWriter，即使配置了GIN_MODE=release</p><p>Logger是把gin框架本身的日志输出到标准输出（我们本地开发调试时在终端输出的那些日志就是它的功劳）</p></li><li><p>Recovery中间件</p><p>是在程序出现panic的时候恢复现场并写入500响应的。</p></li></ul><p>如果不想使用以上默认的两个中间件，可以使用gin.New()新建一个没有任何默认中间件的路由。</p></li><li><p>中间件中使用goroutine</p><p>当在中间件中启动新的goroutine时，不能使用原始的上下文<code>c *gin.Context</code>，必须使用其只读副本<code>c.Copy()</code></p></li></ol><h2 id="六、model" tabindex="-1"><a class="header-anchor" href="#六、model" aria-hidden="true">#</a> 六、Model</h2><h3 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h3><ol><li>如果应用非常简单的话，可以在Controller里面处理常见的业务逻辑（其实按照目前我的理解来看，Controller层也不是处理全部的业务逻辑，最主要的还是像servlet一样接收了参数之后，做一些简单的处理如参数校验，主要是去调用service层的业务）。但是如果我们有一个功能想在多个控制器复用的话，那么我们就可以把公共的功能单独抽取出来作为一个模块（类似Java的utils工具类？？），Model是逐步抽象的过程，一般我们会在Model里面封装一些公共的方法让不同Controller使用，也可以在Model中实现和数据库打交道。</li></ol><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 64005626+shaileneF@users.noreply.github.com">shailene</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/study/assets/app.8fb9e4f4.js" defer></script>
  </body>
</html>
